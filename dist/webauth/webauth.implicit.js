var Implicit=function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}({"./node_modules/adal-angular/lib/adal.js":function(e,t,i){
// @preserve Copyright (c) Microsoft Open Technologies, Inc.
var o=function(){"use strict";return o=function(e){if(this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",UNKNOWN:"UNKNOWN"},this.RESPONSE_TYPE={ID_TOKEN_TOKEN:"id_token token",TOKEN:"token"},this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",ERROR:"error",STORAGE:{TOKEN_KEYS:"adal.token.keys",ACCESS_TOKEN_KEY:"adal.access.token.key",EXPIRATION_KEY:"adal.expiration.key",STATE_LOGIN:"adal.state.login",STATE_RENEW:"adal.state.renew",NONCE_IDTOKEN:"adal.nonce.idtoken",SESSION_STATE:"adal.session.state",USERNAME:"adal.username",IDTOKEN:"adal.idtoken",ERROR:"adal.error",ERROR_DESCRIPTION:"adal.error.description",LOGIN_REQUEST:"adal.login.request",LOGIN_ERROR:"adal.login.error",RENEW_STATUS:"adal.token.renew.status",ANGULAR_LOGIN_REQUEST:"adal.angular.login.request"},RESOURCE_DELIMETER:"|",CACHE_DELIMETER:"||",LOADFRAME_TIMEOUT:6e3,TOKEN_RENEW_STATUS_CANCELED:"Canceled",TOKEN_RENEW_STATUS_COMPLETED:"Completed",TOKEN_RENEW_STATUS_IN_PROGRESS:"In Progress",LOGGING_LEVEL:{ERROR:0,WARN:1,INFO:2,VERBOSE:3},LEVEL_STRING_MAP:{0:"ERROR:",1:"WARNING:",2:"INFO:",3:"VERBOSE:"},POPUP_WIDTH:483,POPUP_HEIGHT:600},o.prototype._singletonInstance)return o.prototype._singletonInstance;if(o.prototype._singletonInstance=this,this.instance="https://login.microsoftonline.com/",this.config={},this.callback=null,this.popUp=!1,this.isAngular=!1,this._user=null,this._activeRenewals={},this._loginInProgress=!1,this._acquireTokenInProgress=!1,this._renewStates=[],this._callBackMappedToRenewStates={},this._callBacksMappedToRenewStates={},this._openedWindows=[],this._requestType=this.REQUEST_TYPE.LOGIN,window._adalInstance=this,e.displayCall&&"function"!=typeof e.displayCall)throw new Error("displayCall is not a function");if(!e.clientId)throw new Error("clientId is required");this.config=this._cloneConfig(e),void 0===this.config.navigateToLoginRequestUrl&&(this.config.navigateToLoginRequestUrl=!0),this.config.popUp&&(this.popUp=!0),this.config.callback&&"function"==typeof this.config.callback&&(this.callback=this.config.callback),this.config.instance&&(this.instance=this.config.instance),this.config.loginResource||(this.config.loginResource=this.config.clientId),this.config.redirectUri||(this.config.redirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.postLogoutRedirectUri||(this.config.postLogoutRedirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.anonymousEndpoints||(this.config.anonymousEndpoints=[]),this.config.isAngular&&(this.isAngular=this.config.isAngular),this.config.loadFrameTimeout&&(this.CONSTANTS.LOADFRAME_TIMEOUT=this.config.loadFrameTimeout)},"undefined"!=typeof window&&(window.Logging={piiLoggingEnabled:!1,level:0,log:function(e){}}),o.prototype.login=function(){if(this._loginInProgress)this.info("Login in progress");else{this._loginInProgress=!0;var e=this._guid();this.config.state=e,this._idTokenNonce=this._guid();var t=this._getItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST);t&&""!==t?this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""):t=window.location.href,this.verbose("Expected state: "+e+" startPage:"+t),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,t),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,e,!0),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var i=this._getNavigateUrl("id_token",null)+"&nonce="+encodeURIComponent(this._idTokenNonce);this.config.displayCall?this.config.displayCall(i):this.popUp?(this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._renewStates.push(e),this.registerCallback(e,this.config.clientId,this.callback),this._loginPopup(i)):this.promptUser(i)}},o.prototype._openPopup=function(e,t,i,o){try{var n=window.screenLeft?window.screenLeft:window.screenX,s=window.screenTop?window.screenTop:window.screenY,r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,h=r/2-i/2+n,c=a/2-o/2+s,l=window.open(e,t,"width="+i+", height="+o+", top="+c+", left="+h);return l.focus&&l.focus(),l}catch(e){return this.warn("Error opening popup, "+e.message),this._loginInProgress=!1,this._acquireTokenInProgress=!1,null}},o.prototype._handlePopupError=function(e,t,i,o,n){this.warn(o),this._saveItem(this.CONSTANTS.STORAGE.ERROR,i),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,o),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,n),t&&this._activeRenewals[t]&&(this._activeRenewals[t]=null),this._loginInProgress=!1,this._acquireTokenInProgress=!1,e&&e(o,null,i)},o.prototype._loginPopup=function(e,t,i){var o=this._openPopup(e,"login",this.CONSTANTS.POPUP_WIDTH,this.CONSTANTS.POPUP_HEIGHT),n=i||this.callback;if(null!=o){if(this._openedWindows.push(o),-1!=this.config.redirectUri.indexOf("#"))var s=this.config.redirectUri.split("#")[0];else s=this.config.redirectUri;var r=this,a=window.setInterval(function(){if(!o||o.closed||void 0===o.closed){var e="Popup Window closed",i="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";return r.isAngular&&r._broadcast("adal:popUpClosed",i+r.CONSTANTS.RESOURCE_DELIMETER+e),r._handlePopupError(n,t,e,i,i),void window.clearInterval(a)}try{var h=o.location;if(-1!=encodeURI(h.href).indexOf(encodeURI(s)))return r.isAngular?r._broadcast("adal:popUpHashChanged",h.hash):r.handleWindowCallback(h.hash),window.clearInterval(a),r._loginInProgress=!1,r._acquireTokenInProgress=!1,r.info("Closing popup window"),r._openedWindows=[],void o.close()}catch(e){}},1)}else{var h="Popup Window is null. This can happen if you are using IE";this._handlePopupError(n,t,"Error opening popup",h,h)}},o.prototype._broadcast=function(e,t){!function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.Event.prototype,window.CustomEvent=e}();var i=new CustomEvent(e,{detail:t});window.dispatchEvent(i)},o.prototype.loginInProgress=function(){return this._loginInProgress},o.prototype._hasResource=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return t&&!this._isEmpty(t)&&t.indexOf(e+this.CONSTANTS.RESOURCE_DELIMETER)>-1},o.prototype.getCachedToken=function(e){if(!this._hasResource(e))return null;var t=this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e),i=this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e),o=this.config.expireOffsetSeconds||300;return i&&i>this._now()+o?t:(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,0),null)},o.prototype.getCachedUser=function(){if(this._user)return this._user;var e=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);return this._user=this._createUser(e),this._user},o.prototype.registerCallback=function(e,t,i){this._activeRenewals[t]=e,this._callBacksMappedToRenewStates[e]||(this._callBacksMappedToRenewStates[e]=[]);var o=this;this._callBacksMappedToRenewStates[e].push(i),this._callBackMappedToRenewStates[e]||(this._callBackMappedToRenewStates[e]=function(i,n,s,r){o._activeRenewals[t]=null;for(var a=0;a<o._callBacksMappedToRenewStates[e].length;++a)try{o._callBacksMappedToRenewStates[e][a](i,n,s,r)}catch(s){o.warn(s)}o._callBacksMappedToRenewStates[e]=null,o._callBackMappedToRenewStates[e]=null})},o.prototype._renewToken=function(e,t,i){this.info("renewToken is called for resource:"+e);var o=this._addAdalFrame("adalRenewFrame"+e),n=this._guid()+"|"+e;this.config.state=n,this._renewStates.push(n),this.verbose("Renew token Expected state: "+n),i=i||"token";var s=this._urlRemoveQueryStringParameter(this._getNavigateUrl(i,e),"prompt");i===this.RESPONSE_TYPE.ID_TOKEN_TOKEN&&(this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),s+="&nonce="+encodeURIComponent(this._idTokenNonce)),s+="&prompt=none",s=this._addHintParameters(s),this.registerCallback(n,e,t),this.verbosePii("Navigate to:"+s),o.src="about:blank",this._loadFrameTimeout(s,"adalRenewFrame"+e,e)},o.prototype._renewIdToken=function(e,t){this.info("renewIdToken is called");var i=this._addAdalFrame("adalIdTokenFrame"),o=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this.config.state=o,this._renewStates.push(o),this.verbose("Renew Idtoken Expected state: "+o);var n=null==t?null:this.config.clientId,s=(t=t||"id_token",this._urlRemoveQueryStringParameter(this._getNavigateUrl(t,n),"prompt"));s+="&prompt=none",s=this._addHintParameters(s),s+="&nonce="+encodeURIComponent(this._idTokenNonce),this.registerCallback(o,this.config.clientId,e),this.verbosePii("Navigate to:"+s),i.src="about:blank",this._loadFrameTimeout(s,"adalIdTokenFrame",this.config.clientId)},o.prototype._urlContainsQueryStringParameter=function(e,t){return new RegExp("[\\?&]"+e+"=").test(t)},o.prototype._urlRemoveQueryStringParameter=function(e,t){var i=new RegExp("(\\&"+t+"=)[^&]+");return e=e.replace(i,""),i=new RegExp("("+t+"=)[^&]+&"),e=e.replace(i,""),i=new RegExp("("+t+"=)[^&]+"),e=e.replace(i,"")},o.prototype._loadFrameTimeout=function(e,t,i){this.verbose("Set loading state to pending for: "+i),this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+i,this.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS),this._loadFrame(e,t);var o=this;setTimeout(function(){if(o._getItem(o.CONSTANTS.STORAGE.RENEW_STATUS+i)===o.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS){o.verbose("Loading frame has timed out after: "+o.CONSTANTS.LOADFRAME_TIMEOUT/1e3+" seconds for resource "+i);var e=o._activeRenewals[i];e&&o._callBackMappedToRenewStates[e]&&o._callBackMappedToRenewStates[e]("Token renewal operation failed due to timeout",null,"Token Renewal Failed"),o._saveItem(o.CONSTANTS.STORAGE.RENEW_STATUS+i,o.CONSTANTS.TOKEN_RENEW_STATUS_CANCELED)}},o.CONSTANTS.LOADFRAME_TIMEOUT)},o.prototype._loadFrame=function(e,t){var i=this;i.info("LoadFrame: "+t);var o=t;setTimeout(function(){var t=i._addAdalFrame(o);""!==t.src&&"about:blank"!==t.src||(t.src=e,i._loadFrame(e,o))},500)},o.prototype.acquireToken=function(e,t){if(this._isEmpty(e))return this.warn("resource is required"),void t("resource is required",null,"resource is required");var i=this.getCachedToken(e);return i?(this.info("Token is already in cache for resource:"+e),void t(null,i,null)):this._user||this.config.extraQueryParameter&&-1!==this.config.extraQueryParameter.indexOf("login_hint")?void(this._activeRenewals[e]?this.registerCallback(this._activeRenewals[e],e,t):(this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,e===this.config.clientId?this._user?(this.verbose("renewing idtoken"),this._renewIdToken(t)):(this.verbose("renewing idtoken and access_token"),this._renewIdToken(t,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)):this._user?(this.verbose("renewing access_token"),this._renewToken(e,t)):(this.verbose("renewing idtoken and access_token"),this._renewToken(e,t,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)))):(this.warn("User login is required"),void t("User login is required",null,"login required"))},o.prototype.acquireTokenPopup=function(e,t,i,o){if(this._isEmpty(e))return this.warn("resource is required"),void o("resource is required",null,"resource is required");if(!this._user)return this.warn("User login is required"),void o("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void o("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var n=this._guid()+"|"+e;this.config.state=n,this._renewStates.push(n),this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,this.verbose("Renew token Expected state: "+n);var s=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");if(s+="&prompt=select_account",t&&(s+=t),i&&-1===s.indexOf("&claims"))s+="&claims="+encodeURIComponent(i);else if(i&&-1!==s.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");s=this._addHintParameters(s),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+e),this.registerCallback(n,e,o),this._loginPopup(s,e,o)},o.prototype.acquireTokenRedirect=function(e,t,i){if(this._isEmpty(e))return this.warn("resource is required"),void o("resource is required",null,"resource is required");var o=this.callback;if(!this._user)return this.warn("User login is required"),void o("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void o("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var n=this._guid()+"|"+e;this.config.state=n,this.verbose("Renew token Expected state: "+n);var s=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");if(s+="&prompt=select_account",t&&(s+=t),i&&-1===s.indexOf("&claims"))s+="&claims="+encodeURIComponent(i);else if(i&&-1!==s.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");s=this._addHintParameters(s),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+e),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,window.location.href),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,n,!0),this.promptUser(s)},o.prototype.promptUser=function(e){e?(this.infoPii("Navigate to:"+e),window.location.replace(e)):this.info("Navigate url is empty")},o.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._renewStates=[],this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"");var e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);if(!this._isEmpty(e)){e=e.split(this.CONSTANTS.RESOURCE_DELIMETER);for(var t=0;t<e.length&&""!==e[t];t++)this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e[t],""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e[t],0)}this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,"")},o.prototype.clearCacheForResource=function(e){this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._hasResource(e)&&(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,0))},o.prototype.logOut=function(){var e;if(this.clearCache(),this._user=null,this.config.logOutUri)e=this.config.logOutUri;else{var t="common",i="";this.config.tenant&&(t=this.config.tenant),this.config.postLogoutRedirectUri&&(i="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri)),e=this.instance+t+"/oauth2/logout?"+i}this.infoPii("Logout navigate to: "+e),this.promptUser(e)},o.prototype._isEmpty=function(e){return void 0===e||!e||0===e.length},o.prototype.getUser=function(e){if("function"!=typeof e)throw new Error("callback is not a function");if(this._user)e(null,this._user);else{var t=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._isEmpty(t)?(this.warn("User information is not available"),e("User information is not available",null)):(this.info("User exists in cache: "),this._user=this._createUser(t),e(null,this._user))}},o.prototype._addHintParameters=function(e){if(this._user&&this._user.profile)if(this._user.profile.sid&&-1!==e.indexOf("&prompt=none"))this._urlContainsQueryStringParameter("sid",e)||(e+="&sid="+encodeURIComponent(this._user.profile.sid));else if(this._user.profile.upn&&(this._urlContainsQueryStringParameter("login_hint",e)||(e+="&login_hint="+encodeURIComponent(this._user.profile.upn)),!this._urlContainsQueryStringParameter("domain_hint",e)&&this._user.profile.upn.indexOf("@")>-1)){var t=this._user.profile.upn.split("@");e+="&domain_hint="+encodeURIComponent(t[t.length-1])}return e},o.prototype._createUser=function(e){var t=null,i=this._extractIdToken(e);return i&&i.hasOwnProperty("aud")&&(i.aud.toLowerCase()===this.config.clientId.toLowerCase()?(t={userName:"",profile:i},i.hasOwnProperty("upn")?t.userName=i.upn:i.hasOwnProperty("email")&&(t.userName=i.email)):this.warn("IdToken has invalid aud field")),t},o.prototype._getHash=function(e){return e.indexOf("#/")>-1?e=e.substring(e.indexOf("#/")+2):e.indexOf("#")>-1&&(e=e.substring(1)),e},o.prototype.isCallback=function(e){e=this._getHash(e);var t=this._deserialize(e);return t.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||t.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||t.hasOwnProperty(this.CONSTANTS.ID_TOKEN)},o.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)},o.prototype.getRequestInfo=function(e){e=this._getHash(e);var t=this._deserialize(e),i={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(t&&(i.parameters=t,t.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||t.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||t.hasOwnProperty(this.CONSTANTS.ID_TOKEN))){i.valid=!0;var o="";if(!t.hasOwnProperty("state"))return this.warn("No state returned"),i;if(this.verbose("State: "+t.state),o=t.state,i.stateResponse=o,this._matchState(i))return i;if(!i.stateMatch&&window.parent){i.requestType=this._requestType;for(var n=this._renewStates,s=0;s<n.length;s++)if(n[s]===i.stateResponse){i.stateMatch=!0;break}}}return i},o.prototype._matchNonce=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN);if(t){t=t.split(this.CONSTANTS.CACHE_DELIMETER);for(var i=0;i<t.length;i++)if(t[i]===e.profile.nonce)return!0}return!1},o.prototype._matchState=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN);if(t){t=t.split(this.CONSTANTS.CACHE_DELIMETER);for(var i=0;i<t.length;i++)if(t[i]===e.stateResponse)return e.requestType=this.REQUEST_TYPE.LOGIN,e.stateMatch=!0,!0}var o=this._getItem(this.CONSTANTS.STORAGE.STATE_RENEW);if(o){o=o.split(this.CONSTANTS.CACHE_DELIMETER);for(i=0;i<o.length;i++)if(o[i]===e.stateResponse)return e.requestType=this.REQUEST_TYPE.RENEW_TOKEN,e.stateMatch=!0,!0}return!1},o.prototype._getResourceFromState=function(e){if(e){var t=e.indexOf("|");if(t>-1&&t+1<e.length)return e.substring(t+1)}return""},o.prototype.saveTokenFromHash=function(e){this.info("State status:"+e.stateMatch+"; Request type:"+e.requestType),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var t,i=this._getResourceFromState(e.stateResponse);e.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)?(this.infoPii("Error :"+e.parameters.error+"; Error description:"+e.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.ERROR,e.parameters.error),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,e.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),e.requestType===this.REQUEST_TYPE.LOGIN&&(this._loginInProgress=!1,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,e.parameters.error_description))):e.stateMatch?(this.info("State is right"),e.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,e.parameters[this.CONSTANTS.SESSION_STATE]),e.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)&&(this.info("Fragment has access token"),this._hasResource(i)||(t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,t+i+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+i,e.parameters[this.CONSTANTS.ACCESS_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+i,this._expiresIn(e.parameters[this.CONSTANTS.EXPIRES_IN]))),e.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)&&(this.info("Fragment has id token"),this._loginInProgress=!1,this._user=this._createUser(e.parameters[this.CONSTANTS.ID_TOKEN]),this._user&&this._user.profile?this._matchNonce(this._user)?(this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,e.parameters[this.CONSTANTS.ID_TOKEN]),i=this.config.loginResource?this.config.loginResource:this.config.clientId,this._hasResource(i)||(t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,t+i+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+i,e.parameters[this.CONSTANTS.ID_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+i,this._user.profile.exp)):(this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce received: "+this._user.profile.nonce+" is not same as requested: "+this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN)),this._user=null):(e.parameters.error="invalid id_token",e.parameters.error_description="Invalid id_token. id_token: "+e.parameters[this.CONSTANTS.ID_TOKEN],this._saveItem(this.CONSTANTS.STORAGE.ERROR,"invalid id_token"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid id_token. id_token: "+e.parameters[this.CONSTANTS.ID_TOKEN])))):(e.parameters.error="Invalid_state",e.parameters.error_description="Invalid_state. state: "+e.stateResponse,this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state. state: "+e.stateResponse));this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+i,this.CONSTANTS.TOKEN_RENEW_STATUS_COMPLETED)},o.prototype.getResourceForEndpoint=function(e){if(this.config&&this.config.anonymousEndpoints)for(var t=0;t<this.config.anonymousEndpoints.length;t++)if(e.indexOf(this.config.anonymousEndpoints[t])>-1)return null;if(this.config&&this.config.endpoints)for(var i in this.config.endpoints)if(e.indexOf(i)>-1)return this.config.endpoints[i];return e.indexOf("http://")>-1||e.indexOf("https://")>-1?this._getHostFromUri(e)===this._getHostFromUri(this.config.redirectUri)?this.config.loginResource:null:this.config.loginResource},o.prototype._getHostFromUri=function(e){var t=String(e).replace(/^(https?:)\/\//,"");return t=t.split("/")[0]},o.prototype.handleWindowCallback=function(e){if(null==e&&(e=window.location.hash),this.isCallback(e)){var t=null,i=!1;this._openedWindows.length>0&&this._openedWindows[this._openedWindows.length-1].opener&&this._openedWindows[this._openedWindows.length-1].opener._adalInstance?(t=this._openedWindows[this._openedWindows.length-1].opener._adalInstance,i=!0):window.parent&&window.parent._adalInstance&&(t=window.parent._adalInstance);var o,n,s=t.getRequestInfo(e),r=null;n=i||window.parent!==window?t._callBackMappedToRenewStates[s.stateResponse]:t.callback,t.info("Returned from redirect url"),t.saveTokenFromHash(s),s.requestType===this.REQUEST_TYPE.RENEW_TOKEN&&window.parent?(window.parent!==window?t.verbose("Window is in iframe, acquiring token silently"):t.verbose("acquiring token interactive in progress"),o=s.parameters[t.CONSTANTS.ACCESS_TOKEN]||s.parameters[t.CONSTANTS.ID_TOKEN],r=t.CONSTANTS.ACCESS_TOKEN):s.requestType===this.REQUEST_TYPE.LOGIN&&(o=s.parameters[t.CONSTANTS.ID_TOKEN],r=t.CONSTANTS.ID_TOKEN);var a=s.parameters[t.CONSTANTS.ERROR_DESCRIPTION],h=s.parameters[t.CONSTANTS.ERROR];try{n&&n(a,o,h,r)}catch(e){t.error("Error occurred in user defined callback function: "+e)}window.parent!==window||i||(t.config.navigateToLoginRequestUrl?window.location.href=t._getItem(t.CONSTANTS.STORAGE.LOGIN_REQUEST):window.location.hash="")}},o.prototype._getNavigateUrl=function(e,t){var i="common";this.config.tenant&&(i=this.config.tenant);var o=this.instance+i+"/oauth2/authorize"+this._serialize(e,this.config,t)+this._addLibMetadata();return this.info("Navigate url:"+o),o},o.prototype._extractIdToken=function(e){var t=this._decodeJwt(e);if(!t)return null;try{var i=t.JWSPayload,o=this._base64DecodeStringUrlSafe(i);return o?JSON.parse(o):(this.info("The returned id_token could not be base64 url safe decoded."),null)}catch(e){this.error("The returned id_token could not be decoded",e)}return null},o.prototype._base64DecodeStringUrlSafe=function(e){return e=e.replace(/-/g,"+").replace(/_/g,"/"),window.atob?decodeURIComponent(escape(window.atob(e))):decodeURIComponent(escape(this._decode(e)))},o.prototype._decode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=(e=String(e).replace(/=+$/,"")).length;if(i%4==1)throw new Error("The token to be decoded is not correctly encoded.");for(var o,n,s,r,a,h,c,l,T="",u=0;u<i;u+=4){if(o=t.indexOf(e.charAt(u)),n=t.indexOf(e.charAt(u+1)),s=t.indexOf(e.charAt(u+2)),r=t.indexOf(e.charAt(u+3)),u+2===i-1){h=(a=o<<18|n<<12|s<<6)>>16&255,c=a>>8&255,T+=String.fromCharCode(h,c);break}if(u+1===i-1){h=(a=o<<18|n<<12)>>16&255,T+=String.fromCharCode(h);break}h=(a=o<<18|n<<12|s<<6|r)>>16&255,c=a>>8&255,l=255&a,T+=String.fromCharCode(h,c,l)}return T},o.prototype._decodeJwt=function(e){if(this._isEmpty(e))return null;var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);return!t||t.length<4?(this.warn("The returned id_token is not parseable."),null):{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},o.prototype._convertUrlSafeToRegularBase64EncodedString=function(e){return e.replace("-","+").replace("_","/")},o.prototype._serialize=function(e,t,i){var o=[];if(null!==t){o.push("?response_type="+e),o.push("client_id="+encodeURIComponent(t.clientId)),i&&o.push("resource="+encodeURIComponent(i)),o.push("redirect_uri="+encodeURIComponent(t.redirectUri)),o.push("state="+encodeURIComponent(t.state)),t.hasOwnProperty("slice")&&o.push("slice="+encodeURIComponent(t.slice)),t.hasOwnProperty("extraQueryParameter")&&o.push(t.extraQueryParameter);var n=t.correlationId?t.correlationId:this._guid();o.push("client-request-id="+encodeURIComponent(n))}return o.join("&")},o.prototype._deserialize=function(e){var t,i=/\+/g,o=/([^&=]+)=([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(i," "))},s={};for(t=o.exec(e);t;)s[n(t[1])]=n(t[2]),t=o.exec(e);return s},o.prototype._decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t},o.prototype._guid=function(){var e=window.crypto||window.msCrypto;if(e&&e.getRandomValues){var t=new Uint8Array(16);return e.getRandomValues(t),t[6]|=64,t[6]&=79,t[8]|=128,t[8]&=191,this._decimalToHex(t[0])+this._decimalToHex(t[1])+this._decimalToHex(t[2])+this._decimalToHex(t[3])+"-"+this._decimalToHex(t[4])+this._decimalToHex(t[5])+"-"+this._decimalToHex(t[6])+this._decimalToHex(t[7])+"-"+this._decimalToHex(t[8])+this._decimalToHex(t[9])+"-"+this._decimalToHex(t[10])+this._decimalToHex(t[11])+this._decimalToHex(t[12])+this._decimalToHex(t[13])+this._decimalToHex(t[14])+this._decimalToHex(t[15])}for(var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",o="0123456789abcdef",n=0,s="",r=0;r<36;r++)"-"!==i[r]&&"4"!==i[r]&&(n=16*Math.random()|0),"x"===i[r]?s+=o[n]:"y"===i[r]?(n&=3,s+=o[n|=8]):s+=i[r];return s},o.prototype._expiresIn=function(e){return e||(e=3599),this._now()+parseInt(e,10)},o.prototype._now=function(){return Math.round((new Date).getTime()/1e3)},o.prototype._addAdalFrame=function(e){if(void 0!==e){this.info("Add adal frame to document:"+e);var t=document.getElementById(e);if(!t){if(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))){var i=document.createElement("iframe");i.setAttribute("id",e),i.setAttribute("aria-hidden","true"),i.style.visibility="hidden",i.style.position="absolute",i.style.width=i.style.height=i.borderWidth="0px",t=document.getElementsByTagName("body")[0].appendChild(i)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+e+'" id="'+e+'" style="display:none"></iframe>');window.frames&&window.frames[e]&&(t=window.frames[e])}return t}},o.prototype._saveItem=function(e,t,i){if(this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation){if(!this._supportsLocalStorage())return this.info("Local storage is not supported"),!1;if(i){var o=this._getItem(e)||"";localStorage.setItem(e,o+t+this.CONSTANTS.CACHE_DELIMETER)}else localStorage.setItem(e,t);return!0}return this._supportsSessionStorage()?(sessionStorage.setItem(e,t),!0):(this.info("Session storage is not supported"),!1)},o.prototype._getItem=function(e){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?localStorage.getItem(e):(this.info("Local storage is not supported"),null):this._supportsSessionStorage()?sessionStorage.getItem(e):(this.info("Session storage is not supported"),null)},o.prototype._supportsLocalStorage=function(){try{return!!window.localStorage&&(window.localStorage.setItem("storageTest","A"),"A"==window.localStorage.getItem("storageTest")&&(window.localStorage.removeItem("storageTest"),!window.localStorage.getItem("storageTest")))}catch(e){return!1}},o.prototype._supportsSessionStorage=function(){try{return!!window.sessionStorage&&(window.sessionStorage.setItem("storageTest","A"),"A"==window.sessionStorage.getItem("storageTest")&&(window.sessionStorage.removeItem("storageTest"),!window.sessionStorage.getItem("storageTest")))}catch(e){return!1}},o.prototype._cloneConfig=function(e){if(null===e||"object"!=typeof e)return e;var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},o.prototype._addLibMetadata=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()},o.prototype.log=function(e,t,i,o){if(e<=Logging.level){if(!Logging.piiLoggingEnabled&&o)return;var n=(new Date).toUTCString(),s="";s=this.config.correlationId?n+":"+this.config.correlationId+"-"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[e]+" "+t:n+":"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[e]+" "+t,i&&(s+="\nstack:\n"+i.stack),Logging.log(s)}},o.prototype.error=function(e,t){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,e,t)},o.prototype.warn=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,e,null)},o.prototype.info=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,e,null)},o.prototype.verbose=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,e,null)},o.prototype.errorPii=function(e,t){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,e,t,!0)},o.prototype.warnPii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,e,null,!0)},o.prototype.infoPii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,e,null,!0)},o.prototype.verbosePii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,e,null,!0)},o.prototype._libVersion=function(){return"1.0.17"},e.exports&&(e.exports=o,e.exports.inject=function(e){return new o(e)}),o}()},"./packages/Microsoft.Office.WebAuth.Implicit/lib/Adal-Msa.js":function(e,t,i){
// @preserve Copyright (c) Microsoft Open Technologies, Inc.
var o=function(){"use strict";return o=function(e){if(this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",UNKNOWN:"UNKNOWN"},this.RESPONSE_TYPE={ID_TOKEN_TOKEN:"id_token token",TOKEN:"token"},this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",ERROR:"error",STORAGE:{TOKEN_KEYS:"msa.token.keys",ACCESS_TOKEN_KEY:"msa.access.token.key",EXPIRATION_KEY:"msa.expiration.key",STATE_LOGIN:"msa.state.login",STATE_RENEW:"msa.state.renew",NONCE_IDTOKEN:"msa.nonce.idtoken",SESSION_STATE:"msa.session.state",USERNAME:"msa.username",IDTOKEN:"msa.idtoken",ERROR:"msa.error",ERROR_DESCRIPTION:"msa.error.description",LOGIN_REQUEST:"msa.login.request",LOGIN_ERROR:"msa.login.error",RENEW_STATUS:"msa.token.renew.status",ANGULAR_LOGIN_REQUEST:"msa.angular.login.request"},RESOURCE_DELIMETER:"|",CACHE_DELIMETER:"||",LOADFRAME_TIMEOUT:6e3,TOKEN_RENEW_STATUS_CANCELED:"Canceled",TOKEN_RENEW_STATUS_COMPLETED:"Completed",TOKEN_RENEW_STATUS_IN_PROGRESS:"In Progress",LOGGING_LEVEL:{ERROR:0,WARN:1,INFO:2,VERBOSE:3},LEVEL_STRING_MAP:{0:"ERROR:",1:"WARNING:",2:"INFO:",3:"VERBOSE:"},POPUP_WIDTH:483,POPUP_HEIGHT:600},o.prototype._singletonInstance)return o.prototype._singletonInstance;if(o.prototype._singletonInstance=this,this.instance="https://login.microsoftonline.com/",this.config={},this.callback=null,this.popUp=!1,this.isAngular=!1,this._user=null,this._activeRenewals={},this._loginInProgress=!1,this._acquireTokenInProgress=!1,this._renewStates=[],this._callBackMappedToRenewStates={},this._callBacksMappedToRenewStates={},this._openedWindows=[],this._requestType=this.REQUEST_TYPE.LOGIN,window._adalInstance=this,e.displayCall&&"function"!=typeof e.displayCall)throw new Error("displayCall is not a function");if(!e.clientId)throw new Error("clientId is required");this.config=this._cloneConfig(e),void 0===this.config.navigateToLoginRequestUrl&&(this.config.navigateToLoginRequestUrl=!0),this.config.popUp&&(this.popUp=!0),this.config.callback&&"function"==typeof this.config.callback&&(this.callback=this.config.callback),this.config.instance&&(this.instance=this.config.instance),this.config.loginResource||(this.config.loginResource=this.config.clientId),this.config.redirectUri||(this.config.redirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.postLogoutRedirectUri||(this.config.postLogoutRedirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.anonymousEndpoints||(this.config.anonymousEndpoints=[]),this.config.isAngular&&(this.isAngular=this.config.isAngular),this.config.loadFrameTimeout&&(this.CONSTANTS.LOADFRAME_TIMEOUT=this.config.loadFrameTimeout)},"undefined"!=typeof window&&(window.Logging={piiLoggingEnabled:!1,level:0,log:function(e){}}),o.prototype.login=function(e){if(this._loginInProgress)this.info("Login in progress");else{this._loginInProgress=!0;var t=this._guid();this.config.state=t,this._idTokenNonce=this._guid();var i=this._getItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST);i&&""!==i?this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""):i=window.location.href,this.verbose("Expected state: "+t+" startPage:"+i),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,i),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,t,!0),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var o=this._getNavigateUrl("id_token",e)+"&nonce="+encodeURIComponent(this._idTokenNonce);this.config.displayCall?this.config.displayCall(o):this.popUp?(this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._renewStates.push(t),this.registerCallback(t,this.config.clientId,this.callback),this._loginPopup(o)):this.promptUser(o)}},o.prototype._openPopup=function(e,t,i,o){try{var n=window.screenLeft?window.screenLeft:window.screenX,s=window.screenTop?window.screenTop:window.screenY,r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,h=r/2-i/2+n,c=a/2-o/2+s,l=window.open(e,t,"width="+i+", height="+o+", top="+c+", left="+h);return l.focus&&l.focus(),l}catch(e){return this.warn("Error opening popup, "+e.message),this._loginInProgress=!1,this._acquireTokenInProgress=!1,null}},o.prototype._handlePopupError=function(e,t,i,o,n){this.warn(o),this._saveItem(this.CONSTANTS.STORAGE.ERROR,i),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,o),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,n),t&&this._activeRenewals[t]&&(this._activeRenewals[t]=null),this._loginInProgress=!1,this._acquireTokenInProgress=!1,e&&e(o,null,i)},o.prototype._loginPopup=function(e,t,i){var o=this._openPopup(e,"login",this.CONSTANTS.POPUP_WIDTH,this.CONSTANTS.POPUP_HEIGHT),n=i||this.callback;if(null!=o){if(this._openedWindows.push(o),-1!=this.config.redirectUri.indexOf("#"))var s=this.config.redirectUri.split("#")[0];else s=this.config.redirectUri;var r=this,a=window.setInterval(function(){if(!o||o.closed||void 0===o.closed){var e="Popup Window closed",i="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";return r.isAngular&&r._broadcast("adal:popUpClosed",i+r.CONSTANTS.RESOURCE_DELIMETER+e),r._handlePopupError(n,t,e,i,i),void window.clearInterval(a)}try{var h=o.location;if(-1!=encodeURI(h.href).indexOf(encodeURI(s)))return r.isAngular?r._broadcast("adal:popUpHashChanged",h.hash):r.handleWindowCallback(h.hash),window.clearInterval(a),r._loginInProgress=!1,r._acquireTokenInProgress=!1,r.info("Closing popup window"),r._openedWindows=[],void o.close()}catch(e){}},1)}else{var h="Popup Window is null. This can happen if you are using IE";this._handlePopupError(n,t,"Error opening popup",h,h)}},o.prototype._broadcast=function(e,t){!function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.Event.prototype,window.CustomEvent=e}();var i=new CustomEvent(e,{detail:t});window.dispatchEvent(i)},o.prototype.loginInProgress=function(){return this._loginInProgress},o.prototype._hasResource=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return t&&!this._isEmpty(t)&&t.indexOf(e+this.CONSTANTS.RESOURCE_DELIMETER)>-1},o.prototype.getCachedToken=function(e){if(!this._hasResource(e))return null;var t=this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e),i=this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e),o=this.config.expireOffsetSeconds||300;return i&&i>this._now()+o?t:(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,0),null)},o.prototype.getCachedUser=function(){if(this._user)return this._user;var e=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);return this._user=this._createUser(e),this._user},o.prototype.registerCallback=function(e,t,i){this._activeRenewals[t]=e,this._callBacksMappedToRenewStates[e]||(this._callBacksMappedToRenewStates[e]=[]);var o=this;this._callBacksMappedToRenewStates[e].push(i),this._callBackMappedToRenewStates[e]||(this._callBackMappedToRenewStates[e]=function(i,n,s,r){o._activeRenewals[t]=null;for(var a=0;a<o._callBacksMappedToRenewStates[e].length;++a)try{o._callBacksMappedToRenewStates[e][a](i,n,s,r)}catch(s){o.warn(s)}o._callBacksMappedToRenewStates[e]=null,o._callBackMappedToRenewStates[e]=null})},o.prototype._renewToken=function(e,t,i){this.info("renewToken is called for scope:"+e);var o=this._addAdalFrame("adalRenewFrame"+e),n=this._guid()+"|"+e;this.config.state=n,this._renewStates.push(n),this.verbose("Renew token Expected state: "+n),i=i||"token";var s=this._urlRemoveQueryStringParameter(this._getNavigateUrl(i,e),"prompt");i===this.RESPONSE_TYPE.ID_TOKEN_TOKEN&&(this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),s+="&nonce="+encodeURIComponent(this._idTokenNonce)),s+="&prompt=none",s=this._addHintParameters(s),this.registerCallback(n,e,t),this.verbosePii("Navigate to:"+s),o.src="about:blank",this._loadFrameTimeout(s,"adalRenewFrame"+e,e)},o.prototype._renewIdToken=function(e,t){this.info("renewIdToken is called");var i=this._addAdalFrame("adalIdTokenFrame"),o=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this.config.state=o,this._renewStates.push(o),this.verbose("Renew Idtoken Expected state: "+o);var n=null==t?null:this.config.clientId,s=(t=t||"id_token",this._urlRemoveQueryStringParameter(this._getNavigateUrl(t,n),"prompt"));s+="&prompt=none",s=this._addHintParameters(s),s+="&nonce="+encodeURIComponent(this._idTokenNonce),this.registerCallback(o,this.config.clientId,e),this.verbosePii("Navigate to:"+s),i.src="about:blank",this._loadFrameTimeout(s,"adalIdTokenFrame",this.config.clientId)},o.prototype._urlContainsQueryStringParameter=function(e,t){return new RegExp("[\\?&]"+e+"=").test(t)},o.prototype._urlRemoveQueryStringParameter=function(e,t){var i=new RegExp("(\\&"+t+"=)[^&]+");return e=e.replace(i,""),i=new RegExp("("+t+"=)[^&]+&"),e=e.replace(i,""),i=new RegExp("("+t+"=)[^&]+"),e=e.replace(i,"")},o.prototype._loadFrameTimeout=function(e,t,i){this.verbose("Set loading state to pending for: "+i),this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+i,this.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS),this._loadFrame(e,t);var o=this;setTimeout(function(){if(o._getItem(o.CONSTANTS.STORAGE.RENEW_STATUS+i)===o.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS){o.verbose("Loading frame has timed out after: "+o.CONSTANTS.LOADFRAME_TIMEOUT/1e3+" seconds for resource "+i);var e=o._activeRenewals[i];e&&o._callBackMappedToRenewStates[e]&&o._callBackMappedToRenewStates[e]("Token renewal operation failed due to timeout",null,"Token Renewal Failed"),o._saveItem(o.CONSTANTS.STORAGE.RENEW_STATUS+i,o.CONSTANTS.TOKEN_RENEW_STATUS_CANCELED)}},o.CONSTANTS.LOADFRAME_TIMEOUT)},o.prototype._loadFrame=function(e,t){var i=this;i.info("LoadFrame: "+t);var o=t;setTimeout(function(){var t=i._addAdalFrame(o);""!==t.src&&"about:blank"!==t.src||(t.src=e,i._loadFrame(e,o))},500)},o.prototype.acquireToken=function(e,t){if(this._isEmpty(e))return this.warn("scope is required"),void t("scope is required",null,"scope is required");var i=this.getCachedToken(e);return i?(this.info("Token is already in cache for scope:"+e),void t(null,i,null)):this._user||this.config.extraQueryParameter&&-1!==this.config.extraQueryParameter.indexOf("username")?void(this._activeRenewals[e]?this.registerCallback(this._activeRenewals[e],e,t):(this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,e===this.config.clientId?this._user?(this.verbose("renewing idtoken"),this._renewIdToken(t)):(this.verbose("renewing idtoken and access_token"),this._renewIdToken(t,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)):this._user?(this.verbose("renewing access_token"),this._renewToken(e,t)):(this.verbose("renewing idtoken and access_token"),this._renewToken(e,t,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)))):(this.warn("User login is required"),void t("User login is required",null,"login required"))},o.prototype.acquireTokenPopup=function(e,t,i,o){if(this._isEmpty(e))return this.warn("resource is required"),void o("resource is required",null,"resource is required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void o("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var n=this._guid()+"|"+e;this.config.state=n,this._renewStates.push(n),this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,this.verbose("Renew token Expected state: "+n);var s=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");if(s+="&prompt=select_account",t&&(s+=t),i&&-1===s.indexOf("&claims"))s+="&claims="+encodeURIComponent(i);else if(i&&-1!==s.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");s=this._addHintParameters(s),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+e),this.registerCallback(n,e,o),this._loginPopup(s,e,o)},o.prototype.acquireTokenRedirect=function(e,t,i){if(this._isEmpty(e))return this.warn("resource is required"),void o("resource is required",null,"resource is required");var o=this.callback;if(!this._user)return this.warn("User login is required"),void o("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void o("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var n=this._guid()+"|"+e;this.config.state=n,this.verbose("Renew token Expected state: "+n);var s=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");if(s+="&prompt=select_account",t&&(s+=t),i&&-1===s.indexOf("&claims"))s+="&claims="+encodeURIComponent(i);else if(i&&-1!==s.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");s=this._addHintParameters(s),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+e),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,window.location.href),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,n,!0),this.promptUser(s)},o.prototype.promptUser=function(e){e?(this.infoPii("Navigate to:"+e),window.location.replace(e)):this.info("Navigate url is empty")},o.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._renewStates=[],this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"");var e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);if(!this._isEmpty(e)){e=e.split(this.CONSTANTS.RESOURCE_DELIMETER);for(var t=0;t<e.length&&""!==e[t];t++)this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e[t],""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e[t],0)}this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,"")},o.prototype.clearCacheForResource=function(e){this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._hasResource(e)&&(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,0))},o.prototype.logOut=function(){var e;if(this.clearCache(),this._user=null,this.config.logOutUri)e=this.config.logOutUri;else{var t="common",i="";this.config.tenant&&(t=this.config.tenant),this.config.postLogoutRedirectUri&&(i="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri)),e=this.instance+t+"/oauth2/logout?"+i}this.infoPii("Logout navigate to: "+e),this.promptUser(e)},o.prototype._isEmpty=function(e){return void 0===e||!e||0===e.length},o.prototype.getUser=function(e){if("function"!=typeof e)throw new Error("callback is not a function");if(this._user)e(null,this._user);else{var t=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._isEmpty(t)?(this.warn("User information is not available"),e("User information is not available",null)):(this.info("User exists in cache: "),this._user=this._createUser(t),e(null,this._user))}},o.prototype._addHintParameters=function(e){if(this._user&&this._user.profile)if(this._user.profile.sid&&-1!==e.indexOf("&prompt=none"))this._urlContainsQueryStringParameter("sid",e)||(e+="&sid="+encodeURIComponent(this._user.profile.sid));else if(this._user.profile.upn&&(this._urlContainsQueryStringParameter("login_hint",e)||(e+="&login_hint="+encodeURIComponent(this._user.profile.upn)),!this._urlContainsQueryStringParameter("domain_hint",e)&&this._user.profile.upn.indexOf("@")>-1)){var t=this._user.profile.upn.split("@");e+="&domain_hint="+encodeURIComponent(t[t.length-1])}return e},o.prototype._createUser=function(e){var t=null,i=this._extractIdToken(e);return i&&i.hasOwnProperty("aud")&&(i.aud.toLowerCase()===this.config.clientId.toLowerCase()?(t={userName:"",profile:i},i.hasOwnProperty("upn")?t.userName=i.upn:i.hasOwnProperty("email")&&(t.userName=i.email)):this.warn("IdToken has invalid aud field")),t},o.prototype._getHash=function(e){return e.indexOf("#/")>-1?e=e.substring(e.indexOf("#/")+2):e.indexOf("#")>-1&&(e=e.substring(1)),e},o.prototype.isCallback=function(e){e=this._getHash(e);var t=this._deserialize(e);return t.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||t.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||t.hasOwnProperty(this.CONSTANTS.ID_TOKEN)},o.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)},o.prototype.getRequestInfo=function(e){e=this._getHash(e);var t=this._deserialize(e),i={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(t&&(i.parameters=t,t.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||t.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||t.hasOwnProperty(this.CONSTANTS.ID_TOKEN))){i.valid=!0;var o="";if(!t.hasOwnProperty("state"))return this.warn("No state returned"),i;if(this.verbose("State: "+t.state),o=t.state,i.stateResponse=o,this._matchState(i))return i;if(!i.stateMatch&&window.parent){i.requestType=this._requestType;for(var n=this._renewStates,s=0;s<n.length;s++)if(n[s]===i.stateResponse){i.stateMatch=!0;break}}}return i},o.prototype._matchNonce=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN);if(t){t=t.split(this.CONSTANTS.CACHE_DELIMETER);for(var i=0;i<t.length;i++)if(t[i]===e.profile.nonce)return!0}return!1},o.prototype._matchState=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN);if(t){t=t.split(this.CONSTANTS.CACHE_DELIMETER);for(var i=0;i<t.length;i++)if(t[i]===e.stateResponse)return e.requestType=this.REQUEST_TYPE.LOGIN,e.stateMatch=!0,!0}var o=this._getItem(this.CONSTANTS.STORAGE.STATE_RENEW);if(o){o=o.split(this.CONSTANTS.CACHE_DELIMETER);for(i=0;i<o.length;i++)if(o[i]===e.stateResponse)return e.requestType=this.REQUEST_TYPE.RENEW_TOKEN,e.stateMatch=!0,!0}return!1},o.prototype._getResourceFromState=function(e){if(e){var t=e.indexOf("|");if(t>-1&&t+1<e.length)return e.substring(t+1)}return""},o.prototype.saveTokenFromHash=function(e){this.info("State status:"+e.stateMatch+"; Request type:"+e.requestType),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var t,i=this._getResourceFromState(e.stateResponse);e.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)?(this.infoPii("Error :"+e.parameters.error+"; Error description:"+e.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.ERROR,e.parameters.error),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,e.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),e.requestType===this.REQUEST_TYPE.LOGIN&&(this._loginInProgress=!1,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,e.parameters.error_description))):e.stateMatch?(this.info("State is right"),e.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,e.parameters[this.CONSTANTS.SESSION_STATE]),e.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)&&(this.info("Fragment has access token"),this._hasResource(i)||(t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,t+i+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+i,e.parameters[this.CONSTANTS.ACCESS_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+i,this._expiresIn(e.parameters[this.CONSTANTS.EXPIRES_IN]))),e.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)&&(this.info("Fragment has id token"),this._loginInProgress=!1,this._user=this._createUser(e.parameters[this.CONSTANTS.ID_TOKEN]),this._user&&this._user.profile?this._matchNonce(this._user)?(this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,e.parameters[this.CONSTANTS.ID_TOKEN]),i=this.config.loginResource?this.config.loginResource:this.config.clientId,this._hasResource(i)||(t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,t+i+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+i,e.parameters[this.CONSTANTS.ID_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+i,this._user.profile.exp)):(this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce received: "+this._user.profile.nonce+" is not same as requested: "+this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN)),this._user=null):(e.parameters.error="invalid id_token",e.parameters.error_description="Invalid id_token. id_token: "+e.parameters[this.CONSTANTS.ID_TOKEN],this._saveItem(this.CONSTANTS.STORAGE.ERROR,"invalid id_token"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid id_token. id_token: "+e.parameters[this.CONSTANTS.ID_TOKEN])))):(e.parameters.error="Invalid_state",e.parameters.error_description="Invalid_state. state: "+e.stateResponse,this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state. state: "+e.stateResponse));this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+i,this.CONSTANTS.TOKEN_RENEW_STATUS_COMPLETED)},o.prototype.getResourceForEndpoint=function(e){if(this.config&&this.config.anonymousEndpoints)for(var t=0;t<this.config.anonymousEndpoints.length;t++)if(e.indexOf(this.config.anonymousEndpoints[t])>-1)return null;if(this.config&&this.config.endpoints)for(var i in this.config.endpoints)if(e.indexOf(i)>-1)return this.config.endpoints[i];return e.indexOf("http://")>-1||e.indexOf("https://")>-1?this._getHostFromUri(e)===this._getHostFromUri(this.config.redirectUri)?this.config.loginResource:null:this.config.loginResource},o.prototype._getHostFromUri=function(e){var t=String(e).replace(/^(https?:)\/\//,"");return t=t.split("/")[0]},o.prototype.handleWindowCallback=function(e){if(null==e&&(e=window.location.hash),this.isCallback(e)){var t=null,i=!1;this._openedWindows.length>0&&this._openedWindows[this._openedWindows.length-1].opener&&this._openedWindows[this._openedWindows.length-1].opener._adalInstance?(t=this._openedWindows[this._openedWindows.length-1].opener._adalInstance,i=!0):window.parent&&window.parent._adalInstance&&(t=window.parent._adalInstance);var o,n,s=t.getRequestInfo(e),r=null;n=i||window.parent!==window?t._callBackMappedToRenewStates[s.stateResponse]:t.callback,t.info("Returned from redirect url"),t.saveTokenFromHash(s),s.requestType===this.REQUEST_TYPE.RENEW_TOKEN&&window.parent?(window.parent!==window?t.verbose("Window is in iframe, acquiring token silently"):t.verbose("acquiring token interactive in progress"),o=s.parameters[t.CONSTANTS.ACCESS_TOKEN]||s.parameters[t.CONSTANTS.ID_TOKEN],r=t.CONSTANTS.ACCESS_TOKEN):s.requestType===this.REQUEST_TYPE.LOGIN&&(o=s.parameters[t.CONSTANTS.ID_TOKEN],r=t.CONSTANTS.ID_TOKEN);var a=s.parameters[t.CONSTANTS.ERROR_DESCRIPTION],h=s.parameters[t.CONSTANTS.ERROR];try{n&&n(a,o,h,r)}catch(e){t.error("Error occurred in user defined callback function: "+e)}window.parent!==window||i||(t.config.navigateToLoginRequestUrl?window.location.href=t._getItem(t.CONSTANTS.STORAGE.LOGIN_REQUEST):window.location.hash="")}},o.prototype._getNavigateUrl=function(e,t){var i=this.instance+"oauth20_authorize.srf"+this._serialize(e,this.config,t);return this.info("Navigate url:"+i),i},o.prototype._extractIdToken=function(e){var t=this._decodeJwt(e);if(!t)return null;try{var i=t.JWSPayload,o=this._base64DecodeStringUrlSafe(i);return o?JSON.parse(o):(this.info("The returned id_token could not be base64 url safe decoded."),null)}catch(e){this.error("The returned id_token could not be decoded",e)}return null},o.prototype._base64DecodeStringUrlSafe=function(e){return e=e.replace(/-/g,"+").replace(/_/g,"/"),window.atob?decodeURIComponent(escape(window.atob(e))):decodeURIComponent(escape(this._decode(e)))},o.prototype._decode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=(e=String(e).replace(/=+$/,"")).length;if(i%4==1)throw new Error("The token to be decoded is not correctly encoded.");for(var o,n,s,r,a,h,c,l,T="",u=0;u<i;u+=4){if(o=t.indexOf(e.charAt(u)),n=t.indexOf(e.charAt(u+1)),s=t.indexOf(e.charAt(u+2)),r=t.indexOf(e.charAt(u+3)),u+2===i-1){h=(a=o<<18|n<<12|s<<6)>>16&255,c=a>>8&255,T+=String.fromCharCode(h,c);break}if(u+1===i-1){h=(a=o<<18|n<<12)>>16&255,T+=String.fromCharCode(h);break}h=(a=o<<18|n<<12|s<<6|r)>>16&255,c=a>>8&255,l=255&a,T+=String.fromCharCode(h,c,l)}return T},o.prototype._decodeJwt=function(e){if(this._isEmpty(e))return null;var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);return!t||t.length<4?(this.warn("The returned id_token is not parseable."),null):{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},o.prototype._convertUrlSafeToRegularBase64EncodedString=function(e){return e.replace("-","+").replace("_","/")},o.prototype._serialize=function(e,t,i){var o=[];return null!==t&&(o.push("?response_type="+e),o.push("client_id="+encodeURIComponent(t.clientId)),i&&o.push("scope="+encodeURIComponent(i)),o.push("redirect_uri="+encodeURIComponent(t.redirectUri)),o.push("state="+encodeURIComponent(t.state)),t.hasOwnProperty("slice")&&o.push("slice="+encodeURIComponent(t.slice)),t.hasOwnProperty("extraQueryParameter")&&o.push(t.extraQueryParameter)),o.join("&")},o.prototype._deserialize=function(e){var t,i=/\+/g,o=/([^&=]+)=([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(i," "))},s={};for(t=o.exec(e);t;)s[n(t[1])]=n(t[2]),t=o.exec(e);return s},o.prototype._decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t},o.prototype._guid=function(){var e=window.crypto||window.msCrypto;if(e&&e.getRandomValues){var t=new Uint8Array(16);return e.getRandomValues(t),t[6]|=64,t[6]&=79,t[8]|=128,t[8]&=191,this._decimalToHex(t[0])+this._decimalToHex(t[1])+this._decimalToHex(t[2])+this._decimalToHex(t[3])+"-"+this._decimalToHex(t[4])+this._decimalToHex(t[5])+"-"+this._decimalToHex(t[6])+this._decimalToHex(t[7])+"-"+this._decimalToHex(t[8])+this._decimalToHex(t[9])+"-"+this._decimalToHex(t[10])+this._decimalToHex(t[11])+this._decimalToHex(t[12])+this._decimalToHex(t[13])+this._decimalToHex(t[14])+this._decimalToHex(t[15])}for(var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",o="0123456789abcdef",n=0,s="",r=0;r<36;r++)"-"!==i[r]&&"4"!==i[r]&&(n=16*Math.random()|0),"x"===i[r]?s+=o[n]:"y"===i[r]?(n&=3,s+=o[n|=8]):s+=i[r];return s},o.prototype._expiresIn=function(e){return e||(e=3599),this._now()+parseInt(e,10)},o.prototype._now=function(){return Math.round((new Date).getTime()/1e3)},o.prototype._addAdalFrame=function(e){if(void 0!==e){this.info("Add adal frame to document:"+e);var t=document.getElementById(e);if(!t){if(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))){var i=document.createElement("iframe");i.setAttribute("id",e),i.setAttribute("aria-hidden","true"),i.style.visibility="hidden",i.style.position="absolute",i.style.width=i.style.height=i.borderWidth="0px",t=document.getElementsByTagName("body")[0].appendChild(i)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+e+'" id="'+e+'" style="display:none"></iframe>');window.frames&&window.frames[e]&&(t=window.frames[e])}return t}},o.prototype._saveItem=function(e,t,i){if(this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation){if(!this._supportsLocalStorage())return this.info("Local storage is not supported"),!1;if(i){var o=this._getItem(e)||"";localStorage.setItem(e,o+t+this.CONSTANTS.CACHE_DELIMETER)}else localStorage.setItem(e,t);return!0}return this._supportsSessionStorage()?(sessionStorage.setItem(e,t),!0):(this.info("Session storage is not supported"),!1)},o.prototype._getItem=function(e){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?localStorage.getItem(e):(this.info("Local storage is not supported"),null):this._supportsSessionStorage()?sessionStorage.getItem(e):(this.info("Session storage is not supported"),null)},o.prototype._supportsLocalStorage=function(){try{return!!window.localStorage&&(window.localStorage.setItem("storageTest","A"),"A"==window.localStorage.getItem("storageTest")&&(window.localStorage.removeItem("storageTest"),!window.localStorage.getItem("storageTest")))}catch(e){return!1}},o.prototype._supportsSessionStorage=function(){try{return!!window.sessionStorage&&(window.sessionStorage.setItem("storageTest","A"),"A"==window.sessionStorage.getItem("storageTest")&&(window.sessionStorage.removeItem("storageTest"),!window.sessionStorage.getItem("storageTest")))}catch(e){return!1}},o.prototype._cloneConfig=function(e){if(null===e||"object"!=typeof e)return e;var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},o.prototype._addLibMetadata=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()},o.prototype.log=function(e,t,i,o){if(e<=Logging.level){if(!Logging.piiLoggingEnabled&&o)return;var n=(new Date).toUTCString(),s="";s=this.config.correlationId?n+":"+this.config.correlationId+"-"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[e]+" "+t:n+":"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[e]+" "+t,i&&(s+="\nstack:\n"+i.stack),Logging.log(s)}},o.prototype.error=function(e,t){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,e,t)},o.prototype.warn=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,e,null)},o.prototype.info=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,e,null)},o.prototype.verbose=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,e,null)},o.prototype.errorPii=function(e,t){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,e,t,!0)},o.prototype.warnPii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,e,null,!0)},o.prototype.infoPii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,e,null,!0)},o.prototype.verbosePii=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,e,null,!0)},o.prototype._libVersion=function(){return"1.0.17"},e.exports&&(e.exports=o,e.exports.inject=function(e){return new o(e)}),o}()},"./packages/Microsoft.Office.WebAuth.Implicit/scripts/Implicit.ts":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,n,s,r,a,h=i("./node_modules/adal-angular/lib/adal.js"),c=i("./packages/Microsoft.Office.WebAuth.Implicit/lib/Adal-Msa.js"),l=!1,T={};function u(e){if(e.isCallback(window.location.hash)){a.log("Hash: "+window.location.hash,l),a.log("application calls getLoginError",l);var t=e.getLoginError();if(t)T.ErrorMessage=t,a.log("Hash Handle Error: "+t,l);else{a.log("application calls getRequestInfo",l);var i=e.getRequestInfo(window.location.hash);e.saveTokenFromHash(i),e.handleWindowCallback()}a.log("Completed Hash Handling",l)}else e.clearCache()}!function(e){var t=function(){function e(){}return e.Aad="aad",e.Msa="msa",e}();e.IdentityProvider=t;var i=function(){function e(){}return e.DefaultExtraQueryString="scope=openid&prompt=none",e.InteractiveExtraQueryString="&scope=openid",e.Resource="&resource=",e.SsoExtraQueryString="&domain_hint=organizations&login_hint=",e}();e.Adal=i;var o=function(){function e(){}return e.DefaultExtraQueryString="prompt=none",e.InteractiveExtraQueryString="",e.SsoExtraQueryString="&response_mode=fragment&username=",e}();e.Msa=o;var n=function(){function e(){}return e.RequestAuthConfig="RequestAuthConfig",e.ResponseAuthConfig="ResponseAuthConfig",e.iFramePrefix="adalRenewFrame",e}();e.PostMessageType=n;var s=function(){function e(){}return e.AadProd="https://login.microsoftonline.com/",e.AadPpe="https://login.windows-ppe.net/",e.MsaProd="https://login.live.com/",e.MsaInt="https://login.live-int.com/",e}();e.Authority=s}(r||(r={})),function(e){function t(e,t){return!(null!=t&&void 0!==t&&!t)}e.log=function(e,i){return!!t(0,i)&&(console.log(e),!0)},e.warn=function(e,i){return!!t(0,i)&&(console.warn(e),!0)},e.error=function(e,i){return!!t(0,i)&&(console.error(e),!0)}}(a||(a={})),t.Load=function(e){var t;switch((s=e).enableConsoleLogging&&(l=s.enableConsoleLogging),o||n||window.addEventListener("message",function(e){if(e.origin==location.origin&&e.data.request==r.PostMessageType.RequestAuthConfig&&e.data.iframe){a.log("received from "+e.data.iframe,l);var t=document.getElementById(e.data.iframe.replace("+"," "));if(null===t)return void a.log("targetiFrame is null",l);var i=t.contentWindow;null!=i&&(a.log("returning to "+e.data.iframe,l),i.postMessage({request:r.PostMessageType.ResponseAuthConfig,config:s},location.origin))}},!1),s.idp.toLowerCase()){case r.IdentityProvider.Msa.toLowerCase():s.msaConfig&&(void 0!==s.msaConfig.authority&&""!=s.msaConfig.authority||(s.msaConfig.authority=r.Authority.MsaProd),t=n=new c({instance:s.msaConfig.authority&&s.msaConfig.authority.length>0&&"/"==s.msaConfig.authority.substr(-1,1)?s.msaConfig.authority:s.msaConfig.authority+"/",clientId:s.msaConfig.appId,cacheLocation:"localStorage",popUp:!1,tenant:void 0,extraQueryParameter:void 0,redirectUri:s.msaConfig.redirectUri?s.msaConfig.redirectUri.split("?")[0]:location.href.split("?")[0],upn:s.msaConfig.upn,timeout:s.msaConfig.timeout?s.msaConfig.timeout:6e3,navigateToLoginRequestUrl:null===s.msaConfig.navigateToLoginRequestUrl||s.msaConfig.navigateToLoginRequestUrl}));break;case r.IdentityProvider.Aad.toLowerCase():default:s.aadConfig&&(void 0!==s.aadConfig.authority&&""!=s.aadConfig.authority||(s.aadConfig.authority=r.Authority.AadProd),t=o=new h({instance:s.aadConfig.authority&&s.aadConfig.authority.length>0&&"/"==s.aadConfig.authority.substr(-1,1)?s.aadConfig.authority:s.aadConfig.authority+"/",clientId:s.aadConfig.appId,cacheLocation:"localStorage",popUp:!1,tenant:s.aadConfig.tenantId?s.aadConfig.tenantId:void 0,extraQueryParameter:r.Adal.DefaultExtraQueryString,redirectUri:s.aadConfig.redirectUri?s.aadConfig.redirectUri.split("?")[0]:location.href.split("?")[0],upn:s.aadConfig.upn,timeout:s.aadConfig.timeout?s.aadConfig.timeout:6e3,navigateToLoginRequestUrl:null===s.aadConfig.navigateToLoginRequestUrl||s.aadConfig.navigateToLoginRequestUrl}))}u(t)};var d=function(e){return new Promise(function(t){return setTimeout(t,e)})};function p(e){return new RegExp("(^|(?<!.)|\\s)\\bopenid\\b((?!.)|$|\\s)","i").test(e)?e:e+" openid"}t.GetToken=function(e,t,i){var h=s.idp.toLowerCase()===r.IdentityProvider.Msa.toLowerCase(),c=h?n:o,S=function(){return new Promise(function(t,u){var d;h?(d=n,n.config.extraQueryParameter=r.Msa.DefaultExtraQueryString+r.Msa.SsoExtraQueryString+n.config.upn):(d=o,o.config.extraQueryParameter=r.Adal.DefaultExtraQueryString+r.Adal.SsoExtraQueryString+o.config.upn),a.log("Config: "+JSON.stringify(c),l),function(e){var t,i;switch(s.idp.toLowerCase()){case r.IdentityProvider.Msa.toLowerCase():t=s.msaConfig,i=n;break;case r.IdentityProvider.Aad.toLowerCase():default:t=s.aadConfig,i=o}var h=e||t.appId,c=i.getCachedUser();(i.config.clientId!=h||c&&c.profile.aud!=h)&&(i.config.clientId=h,a.log("application calls ClearCache",l),i.clearCache(),a.log("Updated AppId: Expected:'"+h+"',ClientId:'"+i.config.clientId+"',User:'"+(c?c.profile.aud:null)+"'",l))}(i),a.log("application calls acquireToken",l),c.acquireToken(h?p(e):e,function(e,i,n){i&&function(e){var t=e.getCachedUser();return!(!t||t.userName.toLowerCase()!=e.config.upn.toLowerCase())||(a.log("Upn in config does not match cached user upn",l),!1)}(d)&&(h||function(e){var t=o._extractIdToken(e).upn;return!(!t||t.toLowerCase()!==o.config.upn.toLowerCase())||(a.log("provided Upn does not match Upn extracted from token",l),!1)}(i))?(a.log("acquireToken->token: "+i,l),T.Token=i,t(T)):(a.log("acquireToken->error: "+n,l),T.ErrorMessage=e,T.ErrorCode=n,u(T))})})};if(t)return(a.log("Logging in",l),c.popUp=!0,c.callback=function(){u(c)},h?(n.config.extraQueryParameter=r.Msa.InteractiveExtraQueryString+r.Msa.SsoExtraQueryString+n.config.upn,c.login(p(e))):(o.config.extraQueryParameter=r.Adal.InteractiveExtraQueryString+r.Adal.SsoExtraQueryString+o.config.upn+r.Adal.Resource+e,c.login()),Promise.resolve()).then(function(){return function e(t){if(a.log("waiting",l),!t.loginInProgress()){var i=t.getLoginError();return i?(a.log("login->error: "+JSON.stringify(i),l),Promise.reject(i)):void a.log("login finished",l)}return d(100).then(function(){return e(t)})}(c)}).catch(function(e){a.log("loginPopup->error: "+e,l)}).then(S);var _=s.idp.toLowerCase()==r.IdentityProvider.Msa.toLowerCase()?n.config.timeout:o.config.timeout,E=!1,N=new Promise(function(e,t){setTimeout(function(){E||(T.ErrorCode="Timeout",T.ErrorMessage="A timeout occurred while acquiring token",a.log("acquireToken->error: "+T.ErrorCode,l),t(T))},_)});return Promise.race([S(),N]).then(function(e){return E=!0,e})},t.GetAuthConfig=function(){return new Promise(function(e,t){new Promise(function(e,t){if(window.location.hash){var i=window.location.hash;i.indexOf("#/")>-1?i=i.substring(i.indexOf("#/")+2):i.indexOf("#")>-1&&(i=i.substring(1));for(var o=i.split("&"),n=0;n<o.length;n++){var s=o[n].split("=");if("state"==decodeURIComponent(s[0])){var r=decodeURIComponent(s[1]).split("|");2==r.length&&e(r[1])}}}t()}).then(function(t){window.addEventListener("message",function(t){t.origin==location.origin&&t.data.request==r.PostMessageType.ResponseAuthConfig&&t.data.config&&e(t.data.config)},!1),parent.postMessage({request:r.PostMessageType.RequestAuthConfig,iframe:r.PostMessageType.iFramePrefix+t},location.origin)},function(){t({})})})},t.SwitchUser=function(){switch(s.idp.toLowerCase()){case r.IdentityProvider.Msa.toLowerCase():a.log("adalMsaApplication calls ClearCache",l),n.clearCache();break;case r.IdentityProvider.Aad.toLowerCase():default:a.log("adalApplication calls ClearCache",l),o.clearCache()}a.log("SwitchUser: Cleared",l)},t.Logout=function(){switch(s.idp.toLowerCase()){case r.IdentityProvider.Msa.toLowerCase():a.log("MSA is not supported yet",l);break;case r.IdentityProvider.Aad.toLowerCase():default:a.log("adalApplication calls logOut",l),o.logOut()}}},0:function(e,t,i){i("./node_modules/adal-angular/lib/adal.js"),i("./packages/Microsoft.Office.WebAuth.Implicit/lib/Adal-Msa.js"),e.exports=i("./packages/Microsoft.Office.WebAuth.Implicit/scripts/Implicit.ts")}});